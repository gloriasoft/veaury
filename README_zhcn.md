<div align=center>
  <img src="https://raw.githubusercontent.com/devilwjp/VueReact/master/vuereact-combined.png"/>
</div>  
<h1 align=center>Veaury</h1>
<h2 align=center>Vue3åº”ç”¨å¯ä»¥ä½¿ç”¨Reactç»„ä»¶ï¼ŒReactåº”ç”¨å¯ä»¥ä½¿ç”¨Vue3ç»„ä»¶ï¼Œå¹¶ä¸”éå¸¸å®Œç¾ï¼</h2> 

## ä»€ä¹ˆæ˜¯Veaury?  
Veaury æ˜¯åŸºäºReactå’ŒVue3çš„å·¥å…·åº“ï¼Œä¸»è¦ç”¨äºReactå’ŒVueåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å…¬å…±ä½¿ç”¨çš„åœºæ™¯ï¼Œä¸»è¦è¿ç”¨åœ¨é¡¹ç›®è¿ç§»ã€æŠ€æœ¯æ ˆèåˆçš„å¼€å‘æ¨¡å¼ã€è·¨æŠ€æœ¯æ ˆä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶çš„åœºæ™¯ã€‚  

## é‡è¦åŠŸèƒ½
- ğŸŒ æ”¯æŒ Vue3   
- ğŸŒˆ æ”¯æŒ Context - åŒä¸€ä¸ªåº”ç”¨ä¸­å‡ºç°çš„vueç»„ä»¶å’Œreactç»„ä»¶çš„contextæ˜¯å…±äº«çš„.  
- ğŸ’— æ”¯æŒè·¨æ¡†æ¶çš„hooksè°ƒç”¨ - å¯ä»¥åœ¨reactç»„ä»¶ä¸­ä½¿ç”¨vueçš„hooksï¼Œè·å–åˆ°vueç»„ä»¶æˆ–è€…åº”ç”¨çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œæ¯”å¦‚vue-routerã€vuexï¼Œä¹Ÿå¯ä»¥åœ¨vueç»„ä»¶ä¸­ä½¿ç”¨reactçš„hooksï¼Œè·å–åˆ°reactç»„ä»¶æˆ–è€…åº”ç”¨çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œæ¯”å¦‚react-routerã€provideã€contextç­‰

## æ”¯æŒVue2ï¼Ÿ
[å®Œç¾æ”¯æŒreactå’Œvue2åŒæ—¶å¼€å‘çš„å·¥å…·åº“vuereact-combined](https://github.com/devilwjp/vuereact-combined)  

## é¡¹ç›®çš„é¢„é…ç½®
ç†è®ºä¸Šï¼Œä¸éœ€è¦åœ¨ React é¡¹ç›®ä¸­åšé¢å¤–çš„é…ç½®æ¥æ”¯æŒ Vueï¼Œä¹Ÿä¸éœ€è¦åœ¨ Vue é¡¹ç›®ä¸­åšé¢å¤–çš„é…ç½®æ¥æ”¯æŒ Reactã€‚  

å¦‚æœè¦è½¬æ¢çš„ React æˆ– Vue ç»„ä»¶æ¥è‡ª npm åŒ…ï¼Œæˆ–è€…å·²ç»ç»è¿‡æ„å»ºï¼ˆä¸æ˜¯ç›´æ¥çš„vueæ–‡ä»¶ä»¥åŠä¸å«æœ‰jsxï¼‰ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ `applyReactInVue` æˆ– `applyVueInReact`ã€‚  

å¦‚æœéœ€è¦åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­åŒæ—¶å¼€å‘ Vue å’Œ Reactï¼Œè€Œä¸æ˜¯ä»…ä»…ä½¿ç”¨ç°æœ‰çš„ npm ç»„ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥åšä¸€äº›é…ç½®ï¼Œé€šå¸¸é…ç½® `webpack.config.js` å’Œ `babel.config.js`ã€‚  

æœ¬é¡¹ç›®ä¸­çš„`dev-project-react`å’Œ`dev-project-vue3`ç›®å½•æ˜¯`veaury`å¼€å‘ç¯å¢ƒçš„åŸºç¡€é¡¹ç›®ï¼Œåˆ†åˆ«ç”±`create-react-app`å’Œ`@vue/cli`åˆ›å»ºçš„ä¸¤ä¸ªåˆå§‹é¡¹ç›®ã€‚  
> **Note:** åœ¨reacté¡¹ç›®ä¸­çš„`config/webpack.config.js`ä»¥åŠvueé¡¹ç›®ä¸­çš„`vue.config.js`é‡Œï¼Œå¯ä»¥æ‰¾åˆ°webpackçš„aliasåˆ«åé…ç½®ï¼Œå°†`veaury`çš„åˆ«åæ³¨é‡Šè§£å¼€ï¼Œå°±å¯ä»¥å¯¹æ ¹é¡¹ç›®ä¸­`src`ç›®å½•é‡Œçš„`veaury`æºä»£ç è¿›è¡Œå¼€å‘è°ƒè¯•äº†
> 
> **Setup:** åœ¨ä¸»é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤è¡Œ`npm run setup:yarn` æˆ–è€… `npm run setup:npm`ï¼Œå¯ä»¥æ•´ä½“å®‰è£…ä¸»é¡¹ç›®å’Œä¸¤ä¸ªè°ƒè¯•ç”¨çš„å­é¡¹ç›®
> 
> **Develop:** åœ¨ä¸»é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤è¡Œ`npm run dev:vue` ä»¥åŠ `npm run setup:npm`å°±å¯ä»¥å¯¹å­é¡¹ç›®è¿›è¡Œå¼€å‘è°ƒè¯•
   
ä»¥ä¸‹ä¿¡æ¯å¯ä»¥ä½œä¸ºå¦‚ä½•é…ç½®reactå’Œvueé¡¹ç›®ä»¥æ”¯æŒå¦ä¸€ç§æ¡†æ¶çš„å‚è€ƒ  
[å¦‚ä½•é…ç½®ç”±'@vue/cli'åˆ›å»ºçš„vueé¡¹ç›®æ”¯æŒå¼€å‘react](https://github.com/devilwjp/veaury/tree/master/dev-project-vue3)  
[å¦‚ä½•é…ç½®ç”±'create-react-app'åˆ›å»ºçš„reacté¡¹ç›®æ”¯æŒå¼€å‘vue](https://github.com/devilwjp/veaury/tree/master/dev-project-react)

## ä½¿ç”¨åœºæ™¯
- ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ åœ¨ä¸€ä¸ªåº”ç”¨ä¸­åŒæ—¶å¼€å‘Reactå’ŒVue
- ğŸƒ ä»Vueé¡¹ç›®è¿ç§»åˆ°Reacté¡¹ç›®ï¼Œæˆ–è€…ä»Reacté¡¹ç›®è¿ç§»åˆ°Vueé¡¹ç›®
- ğŸ“² åœ¨ä¸€ä¸ªåº”ç”¨ä¸­å¯ä»¥éšæ„ä½¿ç”¨Reactæˆ–è€…Vueçš„ç¬¬ä¸‰æ–¹ç»„ä»¶, æ¯”å¦‚ `antd`, `element-ui`, `vuetify`

## å®‰è£…

```sh
# Install with yarn:
$ yarn add veaury
# or with npm:
$ npm i veaury -S
```

## ç”¨æ³•

### åœ¨Vueç»„ä»¶ä¸­ä½¿ç”¨Reactç»„ä»¶ - åŸºæœ¬ç”¨æ³•

```jsx
import {applyVueInReact} from 'veaury'
// è¿™æ˜¯ä¸€ä¸ªVueç»„ä»¶
import BasicVueComponent from './Basic.vue'
import {useState} from 'react'
// ä½¿ç”¨é«˜é˜¶ç»„ä»¶ 'applyVueInReact'
const Basic = applyVueInReact(BasicVueComponent)
export default function () {
  const [foo] = useState('Hello!')
  return <Basic foo={foo}>
    <div>
      é»˜è®¤çš„slot
    </div>
  </Basic>
}
```  

### åœ¨Reactç»„ä»¶ä¸­ä½¿ç”¨Vueç»„ä»¶ - åŸºæœ¬ç”¨æ³•

```vue

<template>
  <Basic :foo="foo">
    <div>
      childrenå†…å®¹
    </div>
  </Basic>
</template>
<script>
import {applyReactInVue} from 'veaury'
// è¿™æ˜¯ä¸€ä¸ªReactç»„ä»¶
import BasicReactComponent from './react_app/Basic.jsx'
import {ref} from 'vue'

export default {
  components: {
    // ä½¿ç”¨é«˜é˜¶ç»„ä»¶ 'applyReactInVue'
    Basic: applyReactInVue(BasicReactComponent)
  },
  setup() {
    return {
      foo: ref('Hello!')
    }
  }
}
</script>
```

### åœ¨Reactç»„ä»¶ä¸­ä½¿ç”¨Vueç»„ä»¶ - äº‹ä»¶çš„ç”¨æ³•

```jsx
import {applyVueInReact} from 'veaury'
import BasicVue from './Basic.vue'
import {useState} from 'react'

const Basic = applyVueInReact(BasicVue)
export default function () {
  function onClickForVue() {
    console.log('clicked!')
  }

  return <div>
    {/*åœ¨Vueç»„ä»¶Basicä¸­å¯ä»¥ä½¿ç”¨$emit('click')è§¦å‘è¿™ä¸ªäº‹ä»¶ç»‘å®šçš„å‡½æ•°*/}
    <Basic onClick={onClickForVue}/>
  </div>
}
```

### åœ¨Vueç»„ä»¶ä¸­ä½¿ç”¨Reactç»„ä»¶ - äº‹ä»¶çš„ç”¨æ³•

```vue

<template>
  <!-- åœ¨Reactç»„ä»¶ReactButtonä¸­å¯ä»¥ä½¿ç”¨props.onClick()è§¦å‘è¿™ä¸ªäº‹ä»¶ç»‘å®šçš„å‡½æ•° -->
  <ReactButton @click="onClickForReact"/>
</template>

<script>
import {applyReactInVue} from 'veaury'
// Reactç»„ä»¶ReactButton
import ReactButton from "./react_app/Button.jsx"

export default {
  components: {
    ReactButton: applyReactInVue(ReactButton)
  },
  setup() {
    function onClickForReact() {
      console.log('clicked!')
    }

    return {
      onClickForReact,
    }
  }
}
</script>
```

### åœ¨Reactç»„ä»¶ä¸­ä½¿ç”¨Vueç»„ä»¶ - æ’æ§½çš„ç”¨æ³•

è¿™ä¸ªæ’æ§½çš„ç”¨æ³•ä¸Vueçš„jsxä¼ é€’æ’æ§½çš„ç”¨æ³•éå¸¸ç›¸ä¼¼

```jsx
import {applyVueInReact} from 'veaury'
import BasicVue from './Basic.vue'

const Basic = applyVueInReact(BasicVue)
export default function () {
  return <div>
    {/*åªä¼ é€’children*/}
    <Basic>
      {/* åœ¨Vueç»„ä»¶çš„templateå†…ä½¿ç”¨'<slot/>'è¿›è¡Œæ¸²æŸ“ */}
      <div>this is children</div>
    </Basic>
    {/*ä¼ é€’ v-slots*/}
    <Basic v-slots={{
      // åœ¨Vueç»„ä»¶çš„templateå†…ä½¿ç”¨'<slot name="slot1" />'è¿›è¡Œæ¸²æŸ“
      slot1: <div>this is slot1(namedSlot)</div>,
      // åœ¨Vueç»„ä»¶çš„templateå†…ä½¿ç”¨'<slot name="slot2" value="xxxxxx"/>'è¿›è¡Œæ¸²æŸ“
      slot2: ({value}) => <div>this is slot2(scopedSlot), and receive value: {value}</div>,
      // åœ¨Vueç»„ä»¶çš„templateå†…ä½¿ç”¨'<slot/>'è¿›è¡Œæ¸²æŸ“
      default: <div>this is children</div>
    }}/>
    {/*å¦ä¸€ç§ç”¨æ³•*/}
    <Basic>
      {{
        slot1: <div>this is slot1(namedSlot)</div>,
        slot2: ({value}) => <div>this is slot2(scopedSlot), and receive value: {value}</div>,
        default: <div>this is children</div>
      }}
    </Basic>
  </div>
}
```

### åœ¨Vueç»„ä»¶ä¸­ä½¿ç”¨Reactç»„ä»¶ - ä¼ é€’render props å’Œ React node çš„ç”¨æ³•

Vue3çš„å…·åæ’æ§½å’Œä½œç”¨åŸŸæ’æ§½ = React render props.  
Vue3çš„é»˜è®¤æ’æ§½å’Œchildren = React props.children.  
ä¸€ä¸ªå¸¦æœ‰`node:`å‰ç¼€çš„å…·åæ’æ§½ = React Node  
```vue
<template>
  <Basic>
    <!--  åœ¨Reactç»„ä»¶é‡Œä½¿ç”¨'props.slot1()'è¿›è¡Œæ¸²æŸ“  -->
    <template v-slot:slot1>
      <div>
        æ’æ§½1 (render props)
      </div>
    </template>
    <!--  åœ¨Reactç»„ä»¶é‡Œä½¿ç”¨'props.slot2("xxxxx")'è¿›è¡Œæ¸²æŸ“  -->
    <template v-slot:slot2="bar">
      <div>
        æ’æ§½2 (render props)<br/>
        ä»Reactç»„ä»¶ä¼ é€’çš„å†…å®¹: {{bar}}
      </div>
    </template>
    <!--  åœ¨Reactç»„ä»¶é‡Œä½¿ç”¨'props.slot3'è¿›è¡Œæ¸²æŸ“  -->
    <template v-slot:node:slot3>
      <div>
        æ’æ§½3 (react node)
      </div>
    </template>
    <!--  åœ¨Reactç»„ä»¶é‡Œä½¿ç”¨'props.children'è¿›è¡Œæ¸²æŸ“  -->
    <div>
      é»˜è®¤æ’æ§½children (react node)
    </div>
  </Basic>
</template>

<script>
import {applyReactInVue} from 'veaury'
// è¿™æ˜¯ä¸€ä¸ªReactç»„ä»¶
import ReactBasic from "./react_app/Slots.jsx"

export default {
  components: {
    Basic: applyReactInVue(ReactBasic)
  }
}
</script>
```

### Context(ä¸Šä¸‹æ–‡)

Veaury ä¼šåˆ¤æ–­å¦‚æœä¸€ä¸ªç»„ä»¶çš„å¤–å±‚æœ‰åŒä¸€ä¸ªæ¡†æ¶çš„ç»„ä»¶å­˜åœ¨ï¼Œé‚£ä¹ˆVeaury å°±ä¼šä½¿ç”¨ React çš„ `Portal` æˆ–è€… Vue çš„ `Teleport`åˆ›å»ºè¢«é«˜é˜¶ç»„ä»¶åŒ…è£…çš„ç›®æ ‡ç»„ä»¶ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨å®ä¾‹ã€‚   
  
è¿™æ˜¯éå¸¸ç‰›é€¼çš„åšæ³•! Veaury å¯ä»¥å¾ˆå¥½åœ°å°†æ ¹èŠ‚ç‚¹çš„ä¸Šä¸‹æ–‡è·¨è¿‡ä¸åŒçš„æ¡†æ¶ç»„ä»¶ä¼ é€’ç»™å†…éƒ¨ä¸æ ¹èŠ‚ç‚¹ç›¸åŒæ¡†æ¶çš„ç»„ä»¶.  

è¿™æ„å‘³ç€ä¸€ä¸ª Vue ç»„ä»¶ä½¿ç”¨äº†ä¸€ä¸ª React ç»„ä»¶ï¼Œç„¶åè¿™ä¸ª React ç»„ä»¶ä½¿ç”¨äº†å¦ä¸€ä¸ª Vue å­ç»„ä»¶ã€‚ è¿™ä¸ª Vue å­ç»„ä»¶å¯ä»¥è·å–å¤–éƒ¨ Vue ç»„ä»¶çš„ä¸Šä¸‹æ–‡ã€‚  

#### Reactç»„ä»¶ä½¿ç”¨Vueç»„ä»¶ - Provider / useContext çš„ç”¨æ³•

```jsx
import {applyVueInReact} from 'veaury'
import BasicVue from './Basic.vue'
import {createContext, useContext} from 'react'

const Basic = applyVueInReact(BasicVue)
// åˆ›å»º React context å¯¹è±¡
const Context = createContext({})

// Reactå­ç»„ä»¶
function SubReactComponent() {
  // è·å– context å€¼
  const {bossName} = useContext(Context)
  return <div className="slot">bossName from Context: {bossName}</div>
}

export default function () {
  // è®¾ç½® context å€¼
  return <Context.Provider value={{bossName: 'God'}}>
    {/* Vueç»„ä»¶Basic */}
    <Basic>
      {/* åœ¨Vueç»„ä»¶çš„childrené‡Œ, Reactå­ç»„ä»¶å¯ä»¥è·å¾—ä»å¤–å±‚Providerä¼ å…¥çš„contextçš„å€¼ */}
      <SubReactComponent/>
    </Basic>
  </Context.Provider>
}
```

#### Vueç»„ä»¶ä½¿ç”¨Reactç»„ä»¶ - Provide / Inject çš„ç”¨æ³•

```vue

<template>
  <Basic>
    <!--  åœ¨è¿™ä¸ªVueç»„ä»¶é‡Œå¯ä»¥é€šè¿‡injectè·å¾—ä»å¤–å±‚provideä¼ å…¥çš„å€¼  -->
    <SubVueComponent/>
  </Basic>
</template>

<script>
import {provide, inject, h} from 'vue'
import {applyReactInVue} from 'veaury'
// è¿™æ˜¯ä¸€ä¸ªReactç»„ä»¶
import ReactBasic from "./react_app/Basic"
// è¿™æ˜¯ä¸€ä¸ªVueç»„ä»¶
const SubVueComponent = {
  setup() {
    // get bossName from injection
    const bossName = inject('bossName')
    return h('div', () => bossName)
  }
}

export default {
  components: {
    Basic: applyReactInVue(ReactBasic),
    SubVueComponent
  },
  setup() {
    // Use 'provide' to set the value of bossName
    provide('bossName', 'God')
  }
}
</script>
```

### åœ¨Reactç»„ä»¶ä¸­ä½¿ç”¨ VueContainer ç»„ä»¶çš„ç”¨æ³•

å¯ä»¥åœ¨Reactç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ `VueContainer` ç»„ä»¶åŠ¨æ€å±•ç¤ºä¸€ä¸ªVueç»„ä»¶  

å½“è¿™ä¸ªReactç»„ä»¶å­˜åœ¨äºæŸä¸ªVueç»„ä»¶ä¸­æ—¶ï¼Œ æ­¤æ—¶Reactç»„ä»¶ä¸­ä½¿ç”¨`VueContainer` å¯ä»¥æ˜¾ç¤ºåœ¨ä¸Šå±‚ Vue åº”ç”¨ä¸­æ³¨å†Œçš„å…¨å±€ Vue ç»„ä»¶ã€‚  

```jsx
import {VueContainer} from "veaury"
import BasicVue from './Basic.vue'

export default function () {
  const passedProps = {
    name: 'Mike'
  }
  // å¦‚æœ 'vue-router' å­˜åœ¨ï¼Œåˆ™æ¸²æŸ“ '<router-view>' å¯ä»¥ä½¿ç”¨ '<VueContainer component="RouterView"/>'
  return <VueContainer component={BasicVue} {...passedProps}/>
}
```

### åœ¨Reactç»„ä»¶ä¸­ä½¿ç”¨Vueç»„ä»¶, v-model / v-models çš„ç”¨æ³•
'v-model' çš„ç”¨æ³•ä¸Vueçš„jsxä¸­çš„'v-model'ç”¨æ³•ç›¸ä¼¼  
The value type of the `v-model` property should be  
`[ modelValue, modelSetter, argumentKey, argumentModifiers ]`  
`[ modelValue, modelSetter, argumentModifiers ]`  
`[ modelValue, modelSetter ]`  
Additional 'argumentKey' attached property, such as `v-model-god={[godValue, setGodValue]}` = `v-model={[godValue, setGodValue, 'god']}`
```typescript
// types
type modelValue = any
type modelSetter = (newValue) => void
type argumentKey = string
type argumentModifiers = string[]
```
```jsx
import {applyVueInReact} from 'veaury'
import BasicVue from './Basic.vue'
import Basic1Vue from './Basic1.vue'
import {useState} from 'react'

const Basic = applyVueInReact(BasicVue)
const Basic1 = applyVueInReact(Basic1Vue)
export default function () {
  const [foo, setFoo] = useState(Math.random())
  const [bar, setBar] = useState(Math.random())
  const [zoo, setZoo] = useState(Math.random())

  return <div>
    <Basic v-model={[foo, setFoo]} v-model-bar={[bar, setBar]} />
    {/*<Basic1 v-model={[zoo, setZoo, 'zoo']}/>*/}
    {/*<Basic1 v-model={[zoo, setZoo, 'zoo', ['number']]}/>*/}
    {/*<Basic1 v-model-zoo={[zoo, setZoo, ['number']]}/>*/}
    <Basic1 v-models={{
      // The key value of 'modelValue' is equivalent to 'v-model'
      modelValue: [zoo, setZoo],
      //...otherModels
    }} />
  </div>
}

```
### API injectPropsFromWrapper
`injectPropsFromWrapper` is a higher order component.  
  
When developing Vue and React applications at the same time, sometimes it is necessary to obtain the context of the React app inside the Vue component, and vice versa.  
  
For example, to get information from `react-router` in Vue components, or to get state from `vuex` in React components.  
  
This API can be used for both Vue and React components.  

```typescript
interface propsFromWrapper {
    [propName: string]: any;
}
type component = object | Function
type computedModeReturn = () => propsFromWrapper
type defaultModeReturn = propsFromWrapper | Function
type allModeReturn = defaultModeReturn | computedModeReturn
type injectionFunction<T = allModeReturn> = (props?: propsFromWrapper) => T

// types of injectPropsFromWrapper
interface injectPropsFromWrapper<T extends allModeReturn = allModeReturn>{
    (injectionFunction: injectionFunction<T>, component:component): component
}
```
#### Usage of injecting React hooks in Vue component
React application uses Vue component, example to get `react-router` inside Vue component.  
```vue
<template>
  <div class="vue-component">
    <h3>This is the Vue Component.</h3>
    the path info from 'react-router': <span style="font-weight: bold">{{pathname + search}}</span><br/><br/>
    <button @click="changeQuery">change query</button>
  </div>
</template>
<script>
// This Vue component will be used in the React app and needs to use the react-router hooks

import { injectPropsFromWrapper } from 'veaury'
import { useLocation, useNavigate } from 'react-router-dom'
import React from 'react'

function ReactInjectionHook (reactProps) {
  // React hooks can be used in this function
  // Use the hooks of react-router-dom
  const reactRouterLocation = useLocation()
  const navigate = useNavigate()
  function changeQuery() {
    navigate(`?a=${Math.random()}`, {replace: true})
  }

  // The returned object will be passed to the Vue component as props
  return {
    pathname: reactRouterLocation.pathname,
    search: reactRouterLocation.search,
    changeQuery
  }
}
// 'injectPropsFromWrapper' returns the original Vue component and will register injectionHook.
// When the Vue component is applied to the React app by 'applyVueInReact',
// InjectionHook will be executed first, otherwise InjectionHook will not be executed
export default injectPropsFromWrapper(ReactInjectionHook, {
  props: {
    pathname: String,
    search: String,
    changeQuery: Function
  }
})
</script>
```
#### Usage of injecting Vue hooks in React component
Vue application uses React component, example to get `vue-router` and `vuex` inside React component.  
There are two modes for injecting functions, 'setup' and 'computed' modes.  
```jsx
import {toRef} from 'vue'
import {useStore} from 'vuex'
import {useRoute, useRouter} from 'vue-router'
import {injectPropsFromWrapper} from 'veaury'

// This React component will be used in the Vue app and needs to use the vue-router and vuex hooks

// setup mode
function VueInjectionHookInSetupMode(vueProps) {
  // Vue hooks can be used in this function
  // This function will be called in the 'setup' hook of the Vue wrapper component
  const store = useStore()
  const route = useRoute()
  const router = useRouter()

  // The returned object will be passed to the React component as props
  return {
    // you need to manually convert to proxy with 'setup' mode
    // otherwise it will not be responsive
    fullPath: toRef(route, 'fullPath'),
    count: toRef(store.state, 'count'),
    changeQuery: () => router.replace({
      query: {
        a: Math.random()
      }
    }),
    incrementCount: () => store.dispatch('increment')
  }
}

// computed mode
function VueInjectionHookInComputedMode(vueProps) {
  // The context of the function is binding with the proxy from the 'getCurrentInstance' hook
  // Returning a function represents the computed of the options api
  // All logic code should be written in this computed function.
  // The lifecycle cannot be used in this function. If you want to use the lifecycle, you can only use the 'setup' mode
  return function computedFunction() {
    return {
      fullPath: this.$route.fullPath,
      count: this.$store.state.count,
      changeQuery: () => this.$router.replace({
        query: {
          a: Math.random()
        }
      }),
      incrementCount: () => this.$store.dispatch('increment')
    }
  }
}

// The first parameter is the injection function.
// Vue's injection function has two modes: 'setup' and 'computed'.
// Refer to the case of the above two injection function types.
// Also try replacing the first parameter with 'VueInjectionHookInComputedMode'
export default injectPropsFromWrapper(VueInjectionHookInSetupMode, function (props) {
  return (<div>
    This is the React Component
    <span>
      the path info from 'vue-router': <span style={{fontWeight: 'bold'}}>{props.fullPath}</span><br/>
      the count from 'vuex': <span style={{fontWeight: 'bold'}}>{props.count}</span>
    </span><br/>
    <button onClick={props.changeQuery}>change query</button> <button onClick={props.incrementCount}>increment count</button>
  </div>)
})

```
> **Note:** If you use interception to wrap the same component multiple times, the previous interception function will be overwritten.  
> 
> Injection functions in 'computed' mode only support synchronous code
> 
> It should be ensured that the logic inside the injection function is a pure function, and business logic should not be added to the injection function. It is not recommended to use lifecycle or asynchronous calls in the injection function.

### Usage of lazyReactInVue
```vue
<template>
  <Basic/>
</template>

<script>
import { lazyReactInVue } from 'veaury'

export default {
  components: {
    // import an async React component
    // It is also possible to use the full parameter of the Vue3 API 'defineAsyncComponent'
    // for example: lazyReactInVue({ loader: () => import('./react_app/Basic'), timeout: 3000 })
    Basic: lazyReactInVue(() => import('./react_app/Basic'))
  },
}
</script>
```
```typescript
// types
type lazyReactInVue = (asyncImport: Promise<any> | defineAsyncComponentOptions, options?: options) => any;
```

### Usage of lazyVueInReact
```jsx
import { lazyVueInReact } from 'veaury'

const AsyncBasic = lazyVueInReact(() => import('./Basic'))
export default function () {
    return <AsyncBasic/>
}
```
```typescript
// types
type lazyReactInVue = (asyncImport: Promise<any>, options?: options) => any
```
